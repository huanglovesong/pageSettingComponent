(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{CS9u:function(e,t,a){},TuE4:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,n,s=M(a("YEIV")),l=M(a("LOOE")),i=M(a("BETb")),u=M(a("QbLZ")),c=M(a("m1cH")),r=M(a("Kl5d")),d=M(a("gDS+")),f=M(a("BEI5")),p=M(a("Yz+Y")),h=M(a("iCc5")),m=M(a("V7oC")),g=M(a("FYw3")),S=M(a("mRg0")),w=M(a("3UyF"));a("jIel"),a("JaZr"),a("TttT"),a("EgL+"),a("RhWh");var v=M(a("q1tI")),E=a("MuoO"),L=M(a("Rnav"));a("CS9u");var y=a("X4fA"),I=M(a("Upkh")),b=M(a("MG2k")),C=a("P5Jw");function M(e){return e&&e.__esModule?e:{default:e}}w.default.alert;var N=(o=function(e){function t(e){(0,h.default)(this,t);var a=(0,g.default)(this,(t.__proto__||(0,p.default)(t)).call(this,e));n.call(a);var o=localStorage.getItem("shopInfo")?JSON.parse(localStorage.getItem("shopInfo")):{},s=localStorage.getItem("userInfo")?JSON.parse(localStorage.getItem("userInfo")):{},l=new f.default.DataSource({rowHasChanged:function(e,t){return e!==t}});return a.consignList=[],a.state={manageDataSource:l.cloneWithRows([]),isSearchFinish:!1,isLoadScroll:!1,isSearchAll:!1,dataSource:[],total:-1,postData:{pageIndex:1,pageSize:30,status:"1"},userInfo:s,showModal:!1,SaleType:11,lineDetail:{},shopInfo:o,showMallLoginModal:!1,showLoginPageModal:!1},a}return(0,S.default)(t,e),(0,m.default)(t,[{key:"componentWillMount",value:function(){var e=this.state,t=e.hasHead;e.shopInfo.codeKey.toLowerCase()===configs.chinaBank.toLowerCase()?t=!(!window.terminal.appVersion||!configs.chinaBankVision)&&-1===window.versionCompare(window.terminal.appVersion,configs.chinaBankVision):t=!1;this.setState({hasHead:t}),(0,y.isLoginOrAuth)(this)&&this.init()}},{key:"componentWillReceiveProps",value:function(e){var t=this,a=this.props,o=e.coupons.GetUserCouponList,n=e.login.fuluusertoken;if(n!==a.login.fuluusertoken){var s=n.code,l=n.data,i=n.message;"1000"===s?(localStorage.setItem("userInfo",(0,d.default)(l)),this.loginSuccess(l)):r.default.fail(i)}if(o!==a.coupons.GetUserCouponList){var u,f=o.code,p=o.data,h=o.message;if("1000"===f)if(p&&p.list&&p.list[0])p.list.map(function(e,t){e.key=(p.current-1)*p.pageSize+t}),(u=this.consignList).push.apply(u,(0,c.default)(p.list)),p.current>=p.pageTotal&&this.setState({isSearchAll:!0}),this.setState({dataSource:[].concat((0,c.default)(this.consignList)),total:p.total,isSearchFinish:!0,isLoadScroll:!1},function(){t.setState({manageDataSource:t.state.manageDataSource.cloneWithRows(t.state.dataSource)})});else this.setState({dataSource:[],total:0,isSearchFinish:!0,isLoadScroll:!1});else"-3"===f||"1013"===f||"1014"===f||"1015"===f?this.authorizationFailure():r.default.info(h)}}},{key:"render",value:function(){var e=this,t=this.state,a=t.manageDataSource,o=t.total,n=t.postData,s=(t.showModal,t.isSearchAll),l=(t.SaleType,t.hasHead),c=t.showMallLoginModal,r=t.showLoginPageModal;return v.default.createElement("div",{className:"mycoupons-list clearfix"},v.default.createElement(L.default,(0,u.default)({},this.props,{jump:function(){return e.props.history.push("/")},myLoading:!!this.props.loading.models.coupons})),v.default.createElement("div",{className:l?"list-con tabs-top":"list-con"},v.default.createElement(i.default,{tabs:[{title:"未使用",sub:"1"},{title:"已使用",sub:"2"},{title:"已过期",sub:"3"}],initialPage:n.status,onChange:function(t,a){n.status=t.sub,n.pageIndex=1,e.consignList=[],e.setState({postData:n},function(){e.init()})}}),0===o?v.default.createElement("div",{className:"noting"},v.default.createElement("span",null),"暂无数据"):v.default.createElement(f.default,{className:"list-view",dataSource:a,renderRow:this.renderRow,initialListSize:n.pageSize,pageSize:n.pageSize,onEndReachedThreshold:10,onEndReached:this.onEndReached,renderFooter:s&&function(){return v.default.createElement("div",{className:"no-more"},"--我是有底线的--")}})),c&&v.default.createElement(I.default,{loginSuccess:this.loginSuccess,hideLoginModal:this.hideLoginModal}),r&&v.default.createElement(b.default,{loginSuccess:this.loginSuccess,hideLoginModal:this.hideLoginModal}))}}]),t}(v.default.Component),n=function(){var e=this;this.loginSuccess=function(t){e.hideLoginModal(),e.setState({userInfo:t},function(){e.init()})},this.init=function(){var t=e.state.postData;e.props.dispatch({type:"coupons/GetUserCouponList",payload:t})},this.authorizationFailure=function(){var t=localStorage.getItem("userInfo")?JSON.parse(localStorage.getItem("userInfo")):{};t.fuluToken="",localStorage.setItem("userInfo",(0,d.default)(t)),(0,y.isLoginOrAuth)(e)},this.toUrl=function(t){e.props.history.push(t)},this.showDown=function(t){var a=e.state.manageDataSource;a._dataBlob.s1[t].show=!a._dataBlob.s1[t].show,e.setState({manageDataSource:a})},this.onCopy=function(t,a,o){a&&(r.default.success("券码复制成功，请在页面跳转后粘贴使用。"),e.jumpTo(o))},this.renderRow=function(t,a,o){return v.default.createElement("div",{className:"order-line"},v.default.createElement("div",{className:1==t.status?"item":"item unStart"},3==t.type?v.default.createElement("div",{className:"left"},v.default.createElement("span",{className:"l-txt"},"兑换券")):v.default.createElement("div",{className:"left"},v.default.createElement("small",null,"￥"),v.default.createElement("strong",null,t.price),v.default.createElement("p",null,t.content)),v.default.createElement("div",{className:"line"}),v.default.createElement("div",{className:"right"},v.default.createElement("div",{className:"txt font-clamp"},t.name),v.default.createElement("div",{className:"time font-clamp"},t.startActiveTime," ~ ",t.endActiveTime),1==t.status?1==t.type?v.default.createElement("button",{className:"get-btn btn-border",onClick:function(){e.jumpTo(t)}},"去使用"):v.default.createElement(C.CopyToClipboard,{text:t.couponCode,onCopy:function(a,o){e.onCopy(a,o,t)}},v.default.createElement("button",{className:"get-btn btn-border"},"去使用")):(t.status,v.default.createElement("p",{className:"btn-txt"},"已使用")),v.default.createElement("div",{className:"use-down",onClick:function(){e.showDown(t.key)}},"使用说明",v.default.createElement(l.default,{type:"down"})))),t.show?v.default.createElement("div",{className:1==t.status?"down-bg":"down-bg unStart"},t.instructions||"",v.default.createElement("span",{className:"more",onClick:function(){e.toUrl("/discription")}},"详细说明",v.default.createElement(l.default,{type:"right"}))):"")},this.onEndReached=function(){var t=e.state,a=t.postData,o=t.isSearchFinish,n=t.isSearchAll;e.setState({isLoadScroll:!0}),o&&!n&&(a.pageIndex++,e.setState({postData:a},function(){e.init()}))},this.changeVal=function(t,a){e.setState((0,s.default)({},t,a))},this.hideLoginModal=function(){e.setState({showMallLoginModal:!1,showLoginPageModal:!1})},this.jumpTo=function(t){1==t.jumpType?e.toUrl("/"):2==t.jumpType?e.toUrl("/couponPage?cardId="+t.couponCode+"&reachedAmount="+t.fullPrice+"&reduceAmount="+t.price):3==t.jumpType?window.location.href="/detail?gid="+t.proClassId+(t.productId?"&pid="+t.productId:""):4==t.jumpType&&(3==t.type?setTimeout(function(){window.location.href=t.jumpUrl},1e3):window.location.href=t.jumpUrl)}},o);t.default=(0,E.connect)(function(e){return(0,u.default)({},e)})(N)},XsNK:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,n=a("TuE4"),s=(o=n)&&o.__esModule?o:{default:o};t.default=s.default}}]);